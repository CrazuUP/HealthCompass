services:
  health-compass-bot:
    build:
      context: ../..
      dockerfile: bot/src/Dockerfile
    ports:
      - "8000:8000"
    environment:
      - MAX_BOT_TOKEN=${MAX_BOT_TOKEN:-test_token}
      - MAX_API_URL=${MAX_API_URL:-https://api.max.ru/v1}
      - WEBHOOK_URL=${WEBHOOK_URL:-https://localhost:8000/webhook}
      - WEBHOOK_SECRET=${WEBHOOK_SECRET:-test_secret}
      - HOST=0.0.0.0
      - PORT=8000
      - DATABASE_URL=${DATABASE_URL:-sqlite:///./health_compass.db}
      - DEBUG=${DEBUG:-True}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
    volumes:
      - ../static:/app/static
      - .:/app
    working_dir: /app
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s